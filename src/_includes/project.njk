---
title: Sam Hopkins | Projects {{ project.title}}
layout: base.njk
---

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

<body>
    {% set project = {
        data: {
            title: title,
            dates: dates,
            collaborators: collaborators,
            cardDescription: cardDescription
        }
    } %}
    <!--link rel="stylesheet" href="bundle.css"-->
    <article>
      <div class='container'>
        <div class="projectView_container">
          <div class="projectView_sideBar">
              <div class="projectView_cardSlot">
                        {% include 'summary-card.njk'  %}
              </div>
              <div class="projectView_photoSlot">
                        <div class="swiper mySwiper">
                          <div class="swiper-wrapper" id="projectView_swiperWrapper">
                          </div>
                          <div class="swiper-button-next"></div>
                          <div class="swiper-button-prev"></div>
                          <div class="swiper-pagination"></div>
                        </div>
              </div>
          </div>
          <div class="projectView_blockText">
            <div id="projectView_outer">
              <div class="projectView_ScrollArticle" id="scrollArticle">
                  {{content | safe}}
              </div>
          </div>
          </div>

          <div class="projectView_navigation" id="projectView_scrollNavBar">
              0 1 2 3 4
          <div>
        </div>
      </div>
    </article>

    <script>
      // use a script tag or an external JS file
      document.addEventListener("DOMContentLoaded", (event) => {
       // gsap code here!
      });
     
    </script>

    <script>
        const setScrollFraction = (newFrac) => {
          newFrac = Math.max(0, Math.min(newFrac, 1));
          
          swipeToFraction(newFrac);

          window.targetScrollFraction = newFrac;
          //window.currentScrollFraction = newFrac;

          history.pushState(null, null, "?persent=" + newFrac * 100);
          gsap.to(document.getElementById('projectView_outer'), {scrollLeft: newFrac * document.getElementById('projectView_outer').scrollWidth, duration: 0.5, ease: "power2.inOut"});
          //document.getElementById('projectView_outer').scrollLeft = newFrac * document.getElementById('projectView_outer').scrollWidth;
        }

        const scrollStep = (pages) =>{
          console.log("scrollStep( " + parseInt( pages ) + ")");

          frac = window.targetScrollFraction;
          frac = Math.min(1, frac + pages*window.scrollStepPercent / 100);
          frac = Math.max(0, frac);

          setScrollFraction(frac);
        }

        const scrollStepRight = () => {scrollStep(window.columnsPerPage);}
        const scrollStepLeft = () => {scrollStep(-1*window.columnsPerPage);}

        document.getElementById('projectView_outer').addEventListener('wheel', function (e) {
            var delta = e.wheelDelta ? e.wheelDelta : -e.deltaY;

            if(delta > 0){
                scrollStepLeft();
            } else {
                scrollStepRight();
            }
        }, false);

        function getListOfImages() {
          str = document.getElementById('scrollArticle').innerHTML;   

          let images = [];
          let regex = /<img\s+src="([^"]+)"\s+alt="([^"]+)"/g;

          let match;
          while ((match = regex.exec(str)) !== null) {
            let image = {
              src: match[1],
              alt: match[2]
            };
            images.push(image);
          }
          console.log(images);

          //put images into swiper-wrapper
          let swiperWrapper = document.getElementById('projectView_swiperWrapper');
          swiperWrapper.innerHTML = '';
          images.forEach(image => {
            swiperWrapper.innerHTML += `<div class="swiper-slide">
                                          <img src="${image.src}" alt="${image.alt}" class="swiper-slide">
                                        </div>`;
          }); 
          swiper.update();
        }

        window.addEventListener('load', function() {
          console.log("get list of images")
          getListOfImages();
          console.log("/get list of images")

          onResize();
          processSlug();
          //window.history.pushState({"html":html,"pageTitle":"fdsfsdf"},"", "somePath");
        });

      window.addEventListener('resize', function() {
        onResize();
      });

      function recalcNumberOfColumns(){
        numberOfColumns = document.getElementById('projectView_outer').scrollWidth / (window.columnWidth+10); //!!!PELIGRO!!! magic number for padding
        numberOfColumns = Math.floor(numberOfColumns);
        window.numberOfColumns = numberOfColumns;
        
        console.log("number of columns: " + numberOfColumns);
      }

      function recalcScrollStep(){
        window.scrollStep = 1/numberOfColumns;
        window.scrollStepPercent = 100 / numberOfColumns;
      }

      function recalcColumnsPerPage(){
        var projectViewOuter = document.getElementById('projectView_outer');
        var elementWidth = projectViewOuter.offsetWidth;
        window.columnsPerPage = parseInt( elementWidth/(416+15) ); //!!!PELIGRO!!! wrong magic numbers, parseint
        console.log("columnsPerPage: " + window.columnsPerPage);
      }

      function recalcColumnWidth(){
        if(window.columnsPerPage == 2){
          window.columnWidth = 416; //!!!PELIGRO!!! magic numbers
          
          document.getElementById('scrollArticle').style.columnWidth = window.columnWidth + 'px';
          console.log(">>>>>columnWidth: " + window.columnWidth);
          return;  
        }
        
        if(window.columnsPerPage > 2){
          console.log("window.columnsPerPage > 2: " + window.columnsPerPage);
          window.columnWidth = 416; //!!!PELIGRO!!! magic numbers
          
          document.getElementById('scrollArticle').style.columnWidth = window.columnWidth + 'px';
          console.log(">>>>>columnWidth: " + window.columnWidth);
          return; 
        }

        var projectViewOuter = document.getElementById('projectView_outer');
        var elementWidth = projectViewOuter.offsetWidth;
        window.columnWidth = elementWidth-50;

        document.getElementById('scrollArticle').style.columnWidth = window.columnWidth + 'px';
        console.log(">>>>>columnWidth: " + window.columnWidth);
      }

      function redrawNavButtons(){
        document.getElementById('projectView_scrollNavBar').innerHTML = '';
        newNav = '';
        
        numberOfButtons = numberOfColumns/window.columnsPerPage;
        numberOfButtons = Math.ceil(numberOfButtons);

        console.log("numberOfColumns: " + numberOfColumns);
        console.log("window.columnsPerPage: " + window.columnsPerPage);
        console.log("numberOfButtons: " + numberOfButtons);

        for (let i = numberOfButtons-1; i >= 0; i--) {
          targetFraction = parseFloat((  (i*window.columnsPerPage) * 100 / numberOfColumns).toFixed(2));
          
          newNav += `<button class="projectView_navigationDigit"
                             id="navButton${i}"
                             targetFraction="${targetFraction}"
                             onclick="setScrollFraction(${targetFraction/100})">
                             ${i}
                    </button>`;
        }
        document.getElementById('projectView_scrollNavBar').innerHTML = newNav;
      }

      function attractScrollToNearestColumn(){
        //!!!!PELIGRO!!!! !!!todo!!!

        // var scrollFraction = window.targetScrollFraction;
        // var columnNumber = parseInt(scrollFraction/window.scrollStep);
        // var newPosition = columnNumber*window.scrollStep;

        // setScrollFraction(newPosition);
      }

      function onResize() {
        recalcColumnsPerPage();
        recalcColumnWidth();
        recalcNumberOfColumns();
        recalcScrollStep();

        redrawNavButtons();
        attractScrollToNearestColumn();
      }

      function processSlug(){
        // Get the current URL
        var currentUrl = window.location.href;
        var slug = currentUrl.substring(currentUrl.lastIndexOf('/') + 1);

        var parameter = slug.split('=')[1];
        if (typeof parameter === 'undefined') {
          parameter = 0;
        }

        frac = parseFloat(parameter) / 100;
        
        columnNumber = parseInt(frac/window.scrollStep);
        newPosition = columnNumber*window.scrollStep;

        //console.log("frac: "+ frac + " scrollStep:" + window.scrollStep + " number: " + columnNumber + " newPosition: " + newPosition);
        setScrollFraction(newPosition);
      }
    </script>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  
  <!-- Initialize Swiper -->
  <script>
    const swiper = new Swiper(".mySwiper", {
      slidesPerView: 1,
      pagination: {
        el: ".swiper-pagination",
        type: "progressbar"
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev"
      }
    });

    function swipeToFraction(persent){
      nSlides = swiper.slides.length;

      if(nSlides == 0)
        return;

      targetSlideNumber = parseInt(nSlides * persent);

      swiper.slideTo(targetSlideNumber);
    }

    function printSwiper(){
      console.log("current index:" + swiper.realIndex);
      console.log("number of slides:" + swiper.slides.length);
      
      if(swiper.slides.length == 0)
        return;

      console.log("current persent:" + swiper.realIndex/swiper.slides.length);
      
      swipeToFraction(0.99);
    }
  </script>