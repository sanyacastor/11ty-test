---
layout: base.njk
tags: preview
permalink: '/preview/{{ preview.title | slug }}/'
templateEngineOverride: md, njk
eleventyComputed:
  title: {{ preview.title }}
  slug: {{ preview.title | slug }}
pagination:
  data: projectWithImages
  alias: preview
  size: 1
  addAllPagesToCollection: true
---

{# {% set project = {
  data: {
      title: preview.title,
      dates: preview.dates,
      collaborators: preview.collaborators,
      cardDescription: preview.cardDescription
  }
} %} <!--!!!Peligro!!! Deleteme--> #}

{% set card_data = {
  data: {
      targetUrl: project.url,
      title: preview.title,
      dates: preview.dates,
      collaborators: preview.collaborators,
      cardDescription: preview.cardDescription
  }
} %}

<link rel="stylesheet" href="bundle.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<article>
  <div class='container'>
    <div class="projectPreview_Grid" id="preview_Grid">
      <div class="preview-grid-card" id="preview-grid-card">
        {% include 'summary-card.njk' %}
      </div>
      <div class="preview-grid-images" id="preview-grid-images">
          <div class="swiper mySwiper">
            <div class="swiper-wrapper previewPage" id="preview_swiperWrapper">
              {% for sliderImage in preview.images %}
                <div class="swiper-slide">
                  {% if sliderImage.url %}
                    {% image sliderImage.url, sliderImage.alt %}
                  {% endif %}
                </div>
              {% endfor %}
            </div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-pagination"></div>
          </div>
      </div>
      <!--imgcaption>asd</imgcaption-->
      <div class="preview-grid-text">
        <div class = "projectPreview_mainTextContainer">
          <div class="projectPreview_textContainer">
            <div id="projectPreview_outer">
              <div class="projectPreview_ScrollArticle" id= "preview_scrollableContent">
                <font>
                  {{preview.previewDescription}}
                </font>
              </div>
              <div class="projectPreview_phantomColumn" id = "phantomColumn">
                <div class="projectPreview_phantomTrigger"  id = "phantomTrigger"></div>
              </div>
            </div>
          </div>
          <div class="navigation_panel">
            <div class="navigation_buttons_group">
              <button class="navigation-button left-button"  id="preview_descriptionNavButton_left">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="23" fill="none">
                  <path fill="currentColor" fill-rule="evenodd" d="M3.27 10 9.344 0h-2.56L1.376 9.216 0 11.2l1.216 1.984L6.784 22.4h2.56L3.063 12H21.88v-2H3.27Z" clip-rule="evenodd"/>
                </svg>
              </button>
              <button class="navigation-button right-button" id="preview_descriptionNavButton_right">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="23" fill="none">
                  <path fill="currentColor" fill-rule="evenodd" d="m18.61 12.4-6.074 10h2.56l5.408-9.216L21.88 11.2l-1.216-1.984L15.096 0h-2.56l6.281 10.4H0v2h18.61Z" clip-rule="evenodd"/>
                </svg>
              </button>
              <button class="navigation-button close-button" id="preview_descriptionNavButton_close">
                <svg width="17" height="23" viewBox="0 0 17 23" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.536 23L7.32 11.832L0.536 0.599998H3.096L8.664 9.816L14.104 0.599998H16.664L9.88 11.8L16.632 23H14.104L8.504 13.784L3.096 23H0.536Z" fill="#6E0B0B"/>
                </svg>
              </button>
            </div>
          </div>
          <button onclick="window.location.href='/projects/project_{{ preview.title | slug }}'" class="projectPreview_buttonFullProject_container" id="preview_buttonFullProject" >
            <a href={{ "/projects/project_" ~ preview.title | slug }}>
              full project
            </a>
            <div class="projectPreview_buttonFullProject_arrowRight" id="preview_buttonFullProject_arrow"></div>
          </button>
        </div>
      </div>  
    </div>
  </div><!--container-->
    {# {% include 'relatedAndMoreCards.njk' %} #}
</article>




<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

<script src="/_scripts/previewDescriptionScroll.js"></script>
<script src="/_scripts/previewImageSwiper.js"></script>
<script src="/_scripts/windowController.js"></script>
<script src="/_scripts/previewNavigationPanel.js"></script>
<script src="/_scripts/tool_emptyParagraphEraser.js"></script>

<script>
  var previewDescriptionScrollInstance;
  var previewImageSwiperInstance;
  var gsapTwiner = gsap;

  var windowControllerInstance;
  var previewNavigationPanelInstance;
  
  document.addEventListener("DOMContentLoaded", (event) => { 
    hideShowSwiperBlock();

    document.documentElement.dataset.scroll = 0;

    windowControllerInstance = new windowController();
    let isMobileVersion = windowControllerInstance.itisMobile();
    console.log("isMobile: " + isMobileVersion);


    previewImageSwiperInstance
                 = new previewImageSwiper('mySwiper',
                                          'preview_swiperWrapper');
    previewNavigationPanelInstance
                 = new previewNavigationPanel('preview_descriptionNavButton_left',
                                              'preview_descriptionNavButton_right',
                                              'preview_descriptionNavButton_close');

    previewDescriptionScrollInstance
                 = new previewDescriptionScroll('projectPreview_outer',
                                            'preview_scrollableContent',
                                            'phantomColumn',
                                            'preview_buttonFullProject',
                                            'preview_buttonFullProject_arrow',
                                            gsapTwiner);

    assignButtonsEvents();

    previewImageSwiperInstance.onLoad(isMobileVersion);
    previewNavigationPanelInstance.update(previewDescriptionScrollInstance);
    previewDescriptionScrollInstance.onload();

    removeEmptyParagraphs('preview_swiperWrapper');
    removeEmptyParagraphs('preview-grid-card');

  });

  function hideShowSwiperBlock(){
    var numSlides = document.querySelectorAll('.swiper-slide').length;
    var previewGridImages = document.getElementById('preview-grid-images');
    
    if (numSlides < 1) {
      previewGridImages.style.display = 'none';
    } else {
      previewGridImages.style.display = 'block';
    }
  }

  window.addEventListener('load', function() {});

  window.addEventListener('resize', function() {
    let isMobileVersion = windowControllerInstance.itisMobile();

    previewDescriptionScrollInstance.onResize();
    previewImageSwiperInstance.recalc(isMobileVersion);

    previewNavigationPanelInstance.update(previewDescriptionScrollInstance);
  });

  document.addEventListener('scroll', function() {
    if(window.scrollY > 650)
      document.documentElement.dataset.scroll = window.scrollY;
    else
      document.documentElement.dataset.scroll = 0;

    if(windowControllerInstance.itisMobile()){
      if (window.scrollY === 0) {
        console.log("mobile scrolling top");
      }
      else{
        console.log("mobile scrolling");
      }
    }
    else
      console.log("desktop scrolling");
  });

  document
    .getElementById('projectPreview_outer')
    .addEventListener('wheel', function (e) {
      if(windowControllerInstance.itisMobile())
        return;

      // Cross-browser wheel delta
      var delta = e.wheelDelta
        ? e.wheelDelta
        : -e.deltaY;
      
      if(delta>0)
        previewDescriptionScrollInstance.scrollLeft();
      else
        previewDescriptionScrollInstance.scrollRight();

      previewNavigationPanelInstance.update(previewDescriptionScrollInstance);

      //  this.scrollLeft -= (delta);
      e.preventDefault();
    }, false);

  document
    .getElementById('preview_swiperWrapper')
    .addEventListener('wheel', function(e) {
      if(windowControllerInstance.itisMobile())
        return;

      var delta = e.wheelDelta ? e.wheelDelta : -e.deltaY;

      if(delta > 0){
        previewImageSwiperInstance.slidePrev();
      } else {
        previewImageSwiperInstance.slideNext();
      }

      previewNavigationPanelInstance.update(previewDescriptionScrollInstance);
      
      e.preventDefault();
    });

  function assignButtonsEvents(){
    document.getElementById('preview_descriptionNavButton_left').addEventListener('click', function() {
      previewDescriptionScrollInstance.scrollLeft();
      
      previewNavigationPanelInstance.update(previewDescriptionScrollInstance);
    });

    document.getElementById('preview_descriptionNavButton_right').addEventListener('click', function() {
      previewDescriptionScrollInstance.scrollRight();
      
      previewNavigationPanelInstance.update(previewDescriptionScrollInstance);
    });

    document.getElementById('preview_descriptionNavButton_close').addEventListener('click', function() {
      window.location.href = '/';
    });
  }
</script>