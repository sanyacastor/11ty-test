---
layout: base.njk
tags: preview
permalink: '/preview/{{ preview.title | slug }}/'
templateEngineOverride: md, njk
eleventyComputed:
  title: {{ preview.title }}
  slug: {{ preview.title | slug }}
pagination:
  data: projectWithImages
  alias: preview
  size: 1
  addAllPagesToCollection: true
---

{% set project = {
  data: {
      title: preview.title,
      dates: preview.dates,
      collaborators: preview.collaborators,
      cardDescription: preview.cardDescription
  }
} %} <!--!!!Peligro!!! Deleteme-->

<link rel="stylesheet" href="bundle.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />


<article>
  <div class='container'>
    <div class="projectPreview_Grid">
      <card>
        {% include 'summary-card.njk' %}
      </card>
      <pictures>
        <div class="swiper mySwiper">
          <div class="swiper-wrapper" id="projectPreview_swiperWrapper">
            {% for image in preview.images %}
              <div class="swiper-slide">
                <img src='{{ image.url }}' alt='{{ image.alt }}' style='width: 100%; display: block; object-fit: cover; margin: auto;'></img> <!--style='object-fit: cover;'-->
              </div>
            {% endfor %}
          </div>
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-pagination"></div>
        </div>
      </pictures>
      <!--imgcaption>asd</imgcaption-->
      <navigationpanel>
        <div class="navigation_buttons_group">
          <button class="navigation-button left-button" onclick="scrollTextLeft()">Left</button>
          <button class="navigation-button right-button" onclick="scrollTextRight()">Right</button>
          <button class="navigation-button close-button" onclick="window.location.href = '/'">Close</button>
        </div>
      </navigationpanel>
      <main>
        <div class = "projectPreview_mainTextContainer">
          <div class="projectPreview_textContainer">
            <div id="projectPreview_outer">
              <div class="projectPreview_ScrollArticle" id= "preview_scrollableContent">
                {{preview.previewDescription}}
              </div>
              <div class="projectPreview_phantomColumn" id = "phantomColumn">
                <div class="projectPreview_phantomTrigger"  id = "phantomTrigger"></div>
              </div>
            </div>
          </div>

          <div class="projectPreview_buttonFullProject_container" id="preview_buttonFullProject" >
            <a href={{ "/projects/project_" ~ preview.title | slug }}>
            </a>
            <div class="projectPreview_buttonFullProject_arrowRight" id="iddqd101"></div>  
          </div>
        </div>
      </main>  
    </div>


  </div>
</article>

<!-- Horisontal scroll -->
<script>
  document
    .getElementById('projectPreview_outer')
    .addEventListener('wheel', function (e) {
      console.log("checkpoints: " + checkpoints);

      // Cross-browser wheel delta
      var delta = e.wheelDelta
        ? e.wheelDelta
        : -e.deltaY;
      
        if(delta>0)
          scrollTextLeft();
        else
          scrollTextRight();
      //  this.scrollLeft -= (delta);
      e.preventDefault();
    }, false);

  document
    .getElementById('projectPreview_swiperWrapper')
    .addEventListener('wheel', function(e) {
      var delta = e.wheelDelta ? e.wheelDelta : -e.deltaY;

      if(delta > 0){
        swiper.slidePrev();
      } else {
        swiper.slideNext();
      }
    });
</script>


<!-- Swiper -->
<script>
  var swiper = new Swiper(".mySwiper", {
    slidesPerView: 2,
    speed: 1000,
    
    autoplay: {
      delay: 2000,
      pauseOnMouseEnter: true,
    },
    pagination: {
      el: ".swiper-pagination",
      type: "progressbar",
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
  });
</script>


<script src="/_data/test.js"></script>
<script src="/_data/windowController.js"></script>

<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", (event) => { /* gsap code */});
</script>

<script>
  let checkpoints;
  let currentChecpointIndex = 0;
  let buttonCanBeUnfolded = false;

  var buttonIsFolded = true;
  const projectPreview_buttonFullProject_width = 228;
  const projectPreview_buttonFullProject_padding = 22;

  var fullProject_button_unfold_enabled = false;

  window.addEventListener('resize', function() {
    
    //windowController_recalcWindow();
    recalcUnfoldTriggerPosition();
    updateButtonFoldState();
    recalcCheckpoints();
    recalcSwiperImages();
  });

  window.addEventListener('load', function() {
    //windowController_recalcWindow();
    recalcUnfoldTriggerPosition();
    updateButtonFoldState();
    recalcCheckpoints();
    recalcSwiperImages();
    moveToCheckpoint(0);
  });

  function recalcSwiperImages(){
    boxWidth = document.getElementsByClassName('mySwiper')[0].offsetWidth;	
    if(boxWidth > 826){
      swiper.params.slidesPerView = 2;
      document.getElementById('projectPreview_swiperWrapper').style.width = '826px';
    }
    else{
      swiper.params.slidesPerView = 1;
      document.getElementById('projectPreview_swiperWrapper').style.width = '416px';
    }
  }

  function recalcCheckpoints(){
    document.getElementById('phantomColumn').style.display = "none";

    let scrollLength = document.getElementById('projectPreview_outer').scrollWidth;
    let boxWidth = document.getElementById('preview_scrollableContent').offsetWidth;
    
    let paddingLeft = parseInt(window.getComputedStyle(document.getElementById('preview_scrollableContent')).paddingLeft);
    let paddingRight = parseInt(window.getComputedStyle(document.getElementById('preview_scrollableContent')).paddingRight);

    let numberOfSteps = scrollLength / (boxWidth+paddingLeft);

    let fractionalSteps = numberOfSteps % 1;
    if(fractionalSteps > 0.8)  //!!!!Nasty...!!!!
      numberOfSteps = Math.ceil(numberOfSteps);
    else
      numberOfSteps = Math.floor(numberOfSteps);
    
    checkpoints = [];
    for(let i = 0; i < numberOfSteps; i++){
      checkpoints.push(i * (boxWidth+paddingLeft));
    }

    if(checkpoints.length == 1)
      checkpoints[0] = 0;

    document.getElementById('phantomColumn').style.position = "absolute";
    document.getElementById('phantomColumn').style.left = checkpoints[checkpoints.length-1] + boxWidth + paddingLeft + "px";
    document.getElementById('phantomColumn').style.display = "block";
  }

  function scrollTextLeft(){
    let nextCheckpoint = currentChecpointIndex - 1;
    if(nextCheckpoint < 0){
      nextCheckpoint = 0;
    }
    
    moveToCheckpoint(nextCheckpoint);
  }

  function scrollTextRight(){
    let nextCheckpoint = currentChecpointIndex + 1;

    if(nextCheckpoint >= checkpoints.length){
      nextCheckpoint = checkpoints.length - 1;
    }

    moveToCheckpoint(nextCheckpoint);
  }

  function updateButtonFoldState(){
    console.log("updateButtonFoldState");

    if( !buttonCanBeUnfolded || !checkpointIsTheLast())
    {
      console.log("not last");
      foldFullProjectButton();
    } else
    {
      console.log("last");
      unfoldFullProjectButton();
    }
  }

  function moveToCheckpoint(index){
    currentChecpointIndex = index;

    updateButtonFoldState();

    gsap.to(  document.getElementById('projectPreview_outer'),{
                    scrollLeft: checkpoints[index],
                    duration: 0.5, ease: "power2.inOut"
                });
  }

  function checkpointIsTheLast(){
    if(checkpoints == null || checkpoints.length == 0)
      return false;

    return currentChecpointIndex == (checkpoints.length - 1);
  }

  function unfoldFullProjectButton(){
    if(!buttonIsFolded){
        return;
      }

    buttonIsFolded = false;
    let buttonFullProject = document.getElementById("preview_buttonFullProject");
    let buttonFullProject_arrow = document.getElementById("iddqd101");
    
    buttonFullProject.style.height = "288px"; //!!!! Magic number
    buttonFullProject.style.bottom = "90px";  //!!!! Magic number
    /*buttonFullProject.style.right = "200px"; */

    buttonFullProject_arrow.style["border-top"] = "143px solid transparent";
    buttonFullProject_arrow.style["border-bottom"] = "143px solid transparent";
    buttonFullProject_arrow.style.animation = "arrow_slideTop 1s ease";
    buttonFullProject.style.animation = "slideTop 1s ease"; 
  }
  function foldFullProjectButton(){
    if(buttonIsFolded){
        return;
      }
      buttonIsFolded = true;
      
      let buttonFullProject = document.getElementById("preview_buttonFullProject");
      let buttonFullProject_arrow = document.getElementById("iddqd101");

      buttonFullProject.style.height = "61px"; //!!!! Magic number
      buttonFullProject.style.bottom = "8px";  //!!!! Magic number
      /*buttonFullProject.style.right = "50px"; */
      
      buttonFullProject_arrow.style["border-top"] = "30px solid transparent";
      buttonFullProject_arrow.style["border-bottom"] = "30px solid transparent";
      buttonFullProject_arrow.style.animation = "arrow_slideBottom 0.5s ease";
      buttonFullProject.style.animation = "slideBottom 0.5s ease";
  }

  /*const observer = new IntersectionObserver(entries => {
    let buttonFullProject = document.getElementById("preview_buttonFullProject");
    let buttonFullProject_arrow = document.getElementById("iddqd101");

    const isIntersectingValue = entries[0].isIntersecting;
    if(isIntersectingValue){
      unfoldFullProjectButton();
    }
    else{
      foldFullProjectButton();
    }
  })*/

  //observer.observe(document.getElementById("phantomTrigger"));


  function recalcUnfoldTriggerPosition(){
    disableTrigger(); // to get the correct scroll length

    scrollLength = document.getElementById('projectPreview_outer').scrollWidth;
    boxWidth = document.getElementById('projectPreview_outer').offsetWidth;

    columnWidth = document.getElementById('preview_scrollableContent').offsetWidth;
    console.log("numcols: " + (scrollLength) / (columnWidth));
    numberOfColumns = Math.floor( (scrollLength) / (columnWidth)); //!!!PELIGRO!!!! magic number

    let additionalSectionWidth = boxWidth - columnWidth;
    if(additionalSectionWidth < 0)
      additionalSectionWidth = 0;

    document.getElementById('phantomColumn').style.width = additionalSectionWidth + "px";
    document.getElementById('phantomColumn').style.display = "block";
    
    console.log("a");

    buttonCanBeUnfolded = true;

    if(additionalSectionWidth > projectPreview_buttonFullProject_width + 50){ //!!!! Magic number
      buttonCanBeUnfolded = true;
    }
    else
      buttonCanBeUnfolded = false;

    //////CRIME SCENE-DO NOT CROSS//////CRIME SCENE-DO NOT CROSS//////CRIME SCENE-DO NOT CROSS//////CRIME SCENE-DO NOT CROSS
    /*if(numberOfColumns == 1){  
      if(boxWidth > (13 + columnWidth + 228 + 22 + 50)){
        document.getElementById('phantomColumn').style.left = columnWidth + 50 + "px";
        document.getElementById('phantomTrigger').style.display = "block"
        buttonCanBeUnfolded = true;
        console.log("b");
        return;
      }else{
        document.getElementById('phantomTrigger').style.display = "none"
        buttonCanBeUnfolded = false;
        console.log("c");
        return;
      }
    }

    if(boxWidth < windowMaxSize-1){
      document.getElementById('phantomColumn').style.left = (scrollLength) + 50 + "px";
      document.getElementById('phantomTrigger').style.display = "none"
      buttonCanBeUnfolded = false;
      console.log("d")
      return;
    }

    document.getElementById('phantomColumn').style.left = (scrollLength) + 50 + "px";
    document.getElementById('phantomTrigger').style.display = "block"
    buttonCanBeUnfolded = true;
    console.log("e")*/
    //////CRIME SCENE-DO NOT CROSS//////CRIME SCENE-DO NOT CROSS//////CRIME SCENE-DO NOT CROSS//////CRIME SCENE-DO NOT CROSS

    return;
  }

  function disableTrigger(){
    document.getElementById('phantomColumn').style.display = "none"
  }

</script>


<script>

</script>